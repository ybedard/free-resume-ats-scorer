<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATS Resume Match Scorer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for textareas */
        textarea::-webkit-scrollbar {
            width: 8px;
        }

        textarea::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
        }

        textarea::-webkit-scrollbar-track {
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto p-4 sm:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-blue-800">
                ATS Resume Match Scorer
            </h1>
            <p class="mt-2 text-xl text-gray-600">
                See how well your resume matches the job description.
            </p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Input Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Job Description Input -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <label for="jobDescription" class="block text-lg font-semibold text-gray-700 mb-2">1. Paste Job
                        Description</label>
                    <textarea id="jobDescription" rows="12"
                        class="w-full p-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800 resize-none"
                        placeholder="Paste the full job description here..."></textarea>
                </div>

                <!-- Resume Text Input -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <label for="resumeText" class="block text-lg font-semibold text-gray-700 mb-2">2. Paste Your Resume
                        Text</label>
                    <textarea id="resumeText" rows="12"
                        class="w-full p-4 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-gray-800 resize-none"
                        placeholder="Paste the plain text of your resume here..."></textarea>
                </div>

                <!-- Action Button -->
                <button id="scoreButton" onclick="scoreResume()"
                    class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl rounded-xl shadow-lg transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-500/50 disabled:bg-blue-400">
                    <span id="buttonText">Score My Resume</span>
                    <div id="spinner"
                        class="hidden animate-spin h-6 w-6 border-4 border-white border-t-transparent rounded-full mx-auto">
                    </div>
                </button>
            </div>

            <!-- Results Column -->
            <div class="lg:col-span-1">
                <div id="resultsCard" class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 min-h-full">
                    <h2 class="text-2xl font-bold text-blue-800 border-b pb-3 mb-4">
                        ATS Analysis Results
                    </h2>

                    <!-- Match Score Section -->
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-700 flex items-center mb-2">
                            <svg class="w-6 h-6 mr-2 text-green-500" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19V6l12-3v14M9 19c-4.418 0-8-3.582-8-8s3.582-8 8-8m0 16c4.418 0 8-3.582 8-8s-3.582-8-8-8">
                                </path>
                            </svg>
                            Match Score
                        </h3>
                        <p id="matchScoreDisplay" class="text-5xl font-extrabold text-gray-400">
                            --
                        </p>
                        <p class="text-sm text-gray-500 mt-1">/ 100 points</p>
                    </div>

                    <!-- Matched Keywords Section -->
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-700 flex items-center mb-2">
                            <svg class="w-6 h-6 mr-2 text-yellow-500" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                            </svg>
                            Key Matched Keywords
                        </h3>
                        <div id="matchedKeywordsDisplay" class="flex flex-wrap gap-2 text-sm">
                            <span class="text-gray-500 italic">Enter text and click 'Score' to see keywords.</span>
                        </div>
                    </div>

                    <!-- Analysis Summary -->
                    <div>
                        <h3 class="text-xl font-semibold text-gray-700 flex items-center mb-2">
                            <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Summary Analysis
                        </h3>
                        <p id="analysisDisplay" class="text-gray-600 leading-relaxed text-base italic">
                            The analysis will appear here. It will suggest areas for
                            improvement.
                        </p>
                    </div>

                    <!-- Error/Message Box -->
                    <div id="messageBox"
                        class="mt-6 hidden p-4 text-sm rounded-lg bg-red-100 text-red-700 border border-red-300"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const proxyUrl = "https://gemini-ats-proxy.yannick-bedard.workers.dev"; // Replace with your proxy URL
        const form = document.getElementById("atsForm");
        const resultsCard = document.getElementById("resultsCard");
        const loadingSpinner = document.getElementById("loadingSpinner");
        const errorCard = document.getElementById("errorCard");
        const errorText = document.getElementById("errorText");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const jd = document.getElementById("jobDescription").value;
            const resume = document.getElementById("resume").value;

            if (!jd || !resume) {
                errorText.textContent = "Please fill out both the job description and resume fields.";
                errorCard.classList.remove("hidden");
                return;
            }

            // Show loading, hide old results
            loadingSpinner.classList.remove("hidden");
            resultsCard.classList.add("hidden");
            errorCard.classList.add("hidden");

            try {
                // 1. CALL CLOUDFLARE PROXY, NOT GOOGLE
                const response = await fetch(proxyUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        jd: jd,
                        resume: resume,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();

                    throw new Error(
                        errorData.details ||
                        errorData.error ||
                        "HTTP error! status: " + response.status
                    );
                }

                const result = await response.json();

                // 2. POPULATE THE RESULTS
                document.getElementById("score").textContent = `${result.matchScore}%`;
                document.getElementById("analysis").textContent = result.analysis;

                const keywordsList = document.getElementById("keywords");
                keywordsList.innerHTML = ""; // Clear old keywords

                result.matchedKeywords.forEach((keyword) => {
                    const li = document.createElement("li");

                    li.className = "bg-gray-200 text-gray-800 text-sm font-medium mr-2 mb-2 px-2.5 py-0.5 rounded";
                    li.textContent = keyword;
                    keywordsList.appendChild(li);
                });

                resultsCard.classList.remove("hidden");
            }
            catch (error) {
                console.error("Fetch error:", error);
                errorText.textContent = `Error: ${error.message}. Please check the proxy URL or worker logs.`;
                errorCard.classList.remove("hidden");
            }
            finally {
                loadingSpinner.classList.add("hidden");
            }
        });
    </script>
</body>

</html>